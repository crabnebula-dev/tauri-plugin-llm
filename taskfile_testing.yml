version: "3"

env:
  CONTAINER_RUNTIME: container
  CONTAINER_IMAGE_TAG: container-tauri-plugin-llm

tasks:
  default:
    silent: true
    desc: Shows all available tasks
    cmds:
      - task --list-all

  build_container:
    silent: true
    desc: Builds the container for Tauri tests
    cmds:
      - container build -f End2End.dockerfile -t $CONTAINER_IMAGE_TAG .

  container:
    silent: true
    desc: Debuggin task to enter the container
    cmds:
      - $CONTAINER_RUNTIME run -ti --rm -v $(pwd):/testing --cpus 8 -m 16G $CONTAINER_IMAGE_TAG bash

  tests:
    silent: true
    desc: Runs all end to end tests
    cmds:
      - $CONTAINER_RUNTIME run -ti --rm -v $(pwd):/testing --cpus 8 -m 16G $CONTAINER_IMAGE_TAG task 'testing:run_tests'

  run_tests:
    silent: true
    desc: (CONTAINER) Runs the e2e test in 'examples/tauri-app/test/specs/test.e2e.js'
    dir: /testing/examples/tauri-app/test/specs
    env:
      DISPLAY: 0
    cmds:
      - xvfb-run --auto-servernum --server-args='-screen 0 1280x720x24' pnpm test
